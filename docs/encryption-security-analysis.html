<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Syndactyl Encryption & Security Analysis</title>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            securityLevel: 'loose',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });
    </script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #4CAF50;
            padding-bottom: 10px;
        }
        h2 {
            color: #555;
            margin-top: 40px;
            border-bottom: 2px solid #2196F3;
            padding-bottom: 8px;
        }
        .diagram-container {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .description {
            background: #e3f2fd;
            padding: 15px;
            border-left: 4px solid #2196F3;
            margin: 15px 0;
            border-radius: 4px;
        }
        .warning {
            background: #ffebee;
            padding: 15px;
            border-left: 4px solid #f44336;
            margin: 15px 0;
            border-radius: 4px;
        }
        .success {
            background: #e8f5e9;
            padding: 15px;
            border-left: 4px solid #4caf50;
            margin: 15px 0;
            border-radius: 4px;
        }
        .mermaid {
            text-align: center;
        }
        .nav {
            background: white;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .nav a {
            color: #2196F3;
            text-decoration: none;
            margin-right: 20px;
            font-weight: 500;
        }
        .nav a:hover {
            text-decoration: underline;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #2196F3;
            color: white;
        }
        tr:hover {
            background-color: #f5f5f5;
        }
        .encrypted {
            color: #4caf50;
            font-weight: bold;
        }
        .unencrypted {
            color: #f44336;
            font-weight: bold;
        }
        .code-example {
            background: #263238;
            color: #aed581;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <h1>üîê Syndactyl Encryption & Security Analysis</h1>
    
    <div class="nav">
        <strong>Navigation:</strong>
        <a href="architecture-diagram.html">Software Architecture</a>
        <a href="network-topology.html">Network Topology</a>
        <a href="#transport-encryption">Transport Encryption</a>
        <a href="#data-flow">Data Flow</a>
        <a href="#threat-model">Threat Model</a>
        <a href="#recommendations">Security Recommendations</a>
    </div>

    <div class="warning">
        <strong>‚ö†Ô∏è Security Notice:</strong> This diagram shows that while Syndactyl has <strong>transport encryption</strong> (data in transit is protected), it currently lacks <strong>authentication</strong> and <strong>encryption at rest</strong>. This analysis helps identify where security improvements are needed.
    </div>

    <div id="transport-encryption">
        <h2>1. Transport Encryption Overview - 4 Nodes Example</h2>
        <div class="description">
            <strong>Scenario:</strong> 4 systems (Alice, Bob, Carol, Dave) all watching the "CompanyDocs" directory. This diagram shows what is encrypted (green) and what is not (red).
        </div>
        <div class="diagram-container">
            <div class="mermaid">
graph TB
    subgraph "Node 1 - Alice's Laptop"
        A_FS[File System<br/>CompanyDocs/<br/>üîì UNENCRYPTED AT REST]
        A_Obs[Observer<br/>üîì Plaintext Processing]
        A_Hash[SHA-256 Hash<br/>üîì Plaintext]
        A_Event[FileEventMessage<br/>üîì Plaintext in Memory]
        A_Noise[Noise Protocol<br/>üîí ENCRYPTS HERE]
    end
    
    subgraph "Network - Encrypted Transit"
        NET[Internet/LAN<br/>üîí ENCRYPTED with Noise<br/>Yamux Multiplexed]
    end
    
    subgraph "Node 2 - Bob's Desktop"
        B_Noise[Noise Protocol<br/>üîí DECRYPTS HERE]
        B_Event[FileEventMessage<br/>üîì Plaintext in Memory]
        B_Decision[Compare Hash<br/>üîì Plaintext]
        B_Request[FileTransferRequest<br/>üîì Plaintext]
        B_Noise2[Noise Protocol<br/>üîí ENCRYPTS HERE]
    end
    
    subgraph "Node 3 - Carol's Server"
        C_Noise[Noise Protocol<br/>üîí DECRYPTS HERE]
        C_Event[Receive Event<br/>üîì Plaintext]
        C_Skip[File Up-to-date<br/>Skip Transfer]
    end
    
    subgraph "Node 4 - Dave's Workstation"
        D_Noise[Noise Protocol<br/>üîí DECRYPTS HERE]
        D_Event[Receive Event<br/>üîì Plaintext]
        D_Request[FileTransferRequest<br/>üîì Plaintext]
        D_Noise2[Noise Protocol<br/>üîí ENCRYPTS HERE]
    end
    
    A_FS --> A_Obs
    A_Obs --> A_Hash
    A_Hash --> A_Event
    A_Event --> A_Noise
    A_Noise -->|üîí Encrypted<br/>Gossipsub Broadcast| NET
    
    NET -->|üîí Encrypted| B_Noise
    NET -->|üîí Encrypted| C_Noise
    NET -->|üîí Encrypted| D_Noise
    
    B_Noise --> B_Event
    B_Event --> B_Decision
    B_Decision -->|Needs Update| B_Request
    B_Request --> B_Noise2
    B_Noise2 -->|üîí Encrypted<br/>Request-Response| NET
    
    C_Noise --> C_Event
    C_Event --> C_Skip
    
    D_Noise --> D_Event
    D_Event --> D_Request
    D_Request --> D_Noise2
    D_Noise2 -->|üîí Encrypted<br/>Request-Response| NET
    
    NET -->|üîí File Transfer<br/>Encrypted| A_Noise
    
    classDef encrypted fill:#c8e6c9,stroke:#2e7d32,stroke-width:3px
    classDef unencrypted fill:#ffcdd2,stroke:#c62828,stroke-width:3px
    classDef network fill:#bbdefb,stroke:#1565c0,stroke-width:2px
    
    class A_Noise,B_Noise,B_Noise2,C_Noise,D_Noise,D_Noise2,NET encrypted
    class A_FS,A_Obs,A_Hash,A_Event,B_Event,B_Decision,B_Request,C_Event,C_Skip,D_Event,D_Request unencrypted
            </div>
        </div>
    </div>

    <div id="data-flow">
        <h2>2. Detailed Data Flow with Encryption Points</h2>
        <div class="description">
            <strong>Overview:</strong> This sequence diagram shows exactly where encryption happens as Alice's file change propagates to Bob.
        </div>
        <div class="diagram-container">
            <div class="mermaid">
sequenceDiagram
    participant A_Disk as Alice's Disk<br/>üîì Plaintext Storage
    participant A_App as Alice's App<br/>üîì Plaintext Memory
    participant A_Noise as Alice's Noise<br/>üîí Encryption Layer
    participant Network as Network<br/>üîí Encrypted Transit
    participant B_Noise as Bob's Noise<br/>üîí Decryption Layer
    participant B_App as Bob's App<br/>üîì Plaintext Memory
    participant B_Disk as Bob's Disk<br/>üîì Plaintext Storage
    
    Note over A_Disk,B_Disk: Alice modifies "budget.xlsx"
    
    rect rgb(255, 220, 220)
    Note over A_Disk,A_App: üîì UNENCRYPTED ZONE
    A_Disk->>A_App: Read file (plaintext)
    A_App->>A_App: Calculate SHA-256 hash
    A_App->>A_App: Create FileEventMessage<br/>{observer: "CompanyDocs",<br/>path: "budget.xlsx",<br/>hash: "abc123...",<br/>size: 524288}
    end
    
    rect rgb(220, 255, 220)
    Note over A_Noise: üîí ENCRYPTION HAPPENS HERE
    A_App->>A_Noise: Send FileEventMessage (plaintext)
    A_Noise->>A_Noise: Encrypt with Noise Protocol<br/>Key Exchange: X25519<br/>Cipher: ChaCha20-Poly1305
    end
    
    rect rgb(220, 220, 255)
    Note over Network: üîí ENCRYPTED IN TRANSIT
    A_Noise->>Network: Encrypted message
    Network->>B_Noise: Encrypted message
    end
    
    rect rgb(220, 255, 220)
    Note over B_Noise: üîí DECRYPTION HAPPENS HERE
    B_Noise->>B_Noise: Decrypt with Noise Protocol
    B_Noise->>B_App: FileEventMessage (plaintext)
    end
    
    rect rgb(255, 220, 220)
    Note over B_App,B_Disk: üîì UNENCRYPTED ZONE
    B_App->>B_App: Check local file hash
    B_App->>B_App: Hash mismatch - need update
    B_App->>B_App: Create FileTransferRequest
    end
    
    rect rgb(220, 255, 220)
    Note over B_Noise: üîí ENCRYPTION
    B_App->>B_Noise: FileTransferRequest
    B_Noise->>Network: Encrypted request
    Network->>A_Noise: Encrypted request
    A_Noise->>A_App: Decrypted request
    end
    
    rect rgb(255, 220, 220)
    Note over A_Disk,A_App: üîì UNENCRYPTED READ
    A_App->>A_Disk: Read file chunk (1MB plaintext)
    A_Disk->>A_App: Chunk data
    end
    
    rect rgb(220, 255, 220)
    Note over A_Noise,Network: üîí ENCRYPTED TRANSFER
    A_App->>A_Noise: FileTransferResponse (plaintext)
    A_Noise->>Network: Encrypted chunk
    Network->>B_Noise: Encrypted chunk
    B_Noise->>B_App: Decrypted chunk
    end
    
    rect rgb(255, 220, 220)
    Note over B_App,B_Disk: üîì UNENCRYPTED WRITE
    B_App->>B_App: Verify hash
    B_App->>B_Disk: Write to disk (plaintext)
    end
    
    Note over A_Disk,B_Disk: File synchronized
            </div>
        </div>
    </div>

    <div id="encryption-stack">
        <h2>3. Encryption Stack Breakdown</h2>
        <div class="description">
            <strong>Overview:</strong> Shows the layered approach to encryption using the Noise Protocol Framework over TCP.
        </div>
        <div class="diagram-container">
            <div class="mermaid">
graph TB
    subgraph "Application Layer - Node A"
        A1[FileEventMessage<br/>Plaintext JSON/CBOR]
        A2[File Content<br/>Plaintext Bytes]
    end
    
    subgraph "Noise Protocol Layer - Node A"
        N1[Noise Handshake<br/>XX Pattern<br/>X25519 Key Exchange]
        N2[Noise Encryption<br/>ChaCha20-Poly1305<br/>AEAD Cipher]
        N3[Message Authentication<br/>Poly1305 MAC]
    end
    
    subgraph "Transport Layer"
        T1[Yamux Multiplexing<br/>Multiple streams over one connection]
        T2[TCP/IP<br/>Reliable transport]
    end
    
    subgraph "Physical Network"
        P1[Network Interface<br/>Ethernet/WiFi]
        P2[Internet/LAN]
    end
    
    subgraph "Noise Protocol Layer - Node B"
        N4[Noise Decryption<br/>ChaCha20-Poly1305]
        N5[Verify MAC<br/>Poly1305]
        N6[Authenticated & Decrypted]
    end
    
    subgraph "Application Layer - Node B"
        A3[FileEventMessage<br/>Plaintext JSON/CBOR]
        A4[File Content<br/>Plaintext Bytes]
    end
    
    A1 --> N1
    A2 --> N1
    N1 --> N2
    N2 --> N3
    N3 --> T1
    T1 --> T2
    T2 --> P1
    P1 --> P2
    
    P2 --> P1
    P1 --> T2
    T2 --> T1
    T1 --> N4
    N4 --> N5
    N5 --> N6
    N6 --> A3
    N6 --> A4
    
    classDef plaintext fill:#ffcdd2,stroke:#c62828,stroke-width:2px
    classDef encrypted fill:#c8e6c9,stroke:#2e7d32,stroke-width:3px
    classDef transport fill:#bbdefb,stroke:#1565c0,stroke-width:2px
    classDef physical fill:#f0f4c3,stroke:#9e9d24,stroke-width:2px
    
    class A1,A2,A3,A4 plaintext
    class N1,N2,N3,N4,N5,N6 encrypted
    class T1,T2 transport
    class P1,P2 physical
            </div>
        </div>
    </div>

    <div class="success">
        <strong>‚úÖ What IS Protected:</strong>
        <ul>
            <li><strong>Man-in-the-middle attacks:</strong> Noise protocol prevents eavesdropping on network traffic</li>
            <li><strong>Network sniffing:</strong> All data in transit is encrypted with ChaCha20-Poly1305</li>
            <li><strong>Message tampering:</strong> Poly1305 MAC ensures message integrity</li>
            <li><strong>Replay attacks:</strong> Noise includes counter/nonce to prevent replay</li>
        </ul>
    </div>

    <div class="warning">
        <strong>‚ùå What is NOT Protected:</strong>
        <ul>
            <li><strong>Unauthorized access:</strong> Any peer can join the network (no authentication)</li>
            <li><strong>Data at rest:</strong> Files stored on disk are plaintext (no filesystem encryption)</li>
            <li><strong>Memory dumps:</strong> Data in application memory is plaintext</li>
            <li><strong>Access control:</strong> No way to restrict who can access which files</li>
            <li><strong>Malicious peers:</strong> A compromised node can access all files it's configured to sync</li>
        </ul>
    </div>

    <div id="threat-model">
        <h2>4. Threat Model Analysis</h2>
        <div class="description">
            <strong>Overview:</strong> This shows different attack scenarios and whether current encryption protects against them.
        </div>
        <div class="diagram-container">
            <div class="mermaid">
graph TB
    subgraph "Protected Threats ‚úÖ"
        T1[Network Eavesdropper<br/>Passive Listener]
        T2[Man-in-the-Middle<br/>Active Attacker on Network]
        T3[ISP Monitoring<br/>Traffic Analysis]
    end
    
    subgraph "Encryption Defense"
        D1[Noise Protocol<br/>Encrypts all traffic]
        D2[X25519 Key Exchange<br/>Forward Secrecy]
        D3[ChaCha20-Poly1305<br/>AEAD Cipher]
    end
    
    subgraph "Unprotected Threats ‚ùå"
        U1[Unauthorized Peer<br/>Joins Network]
        U2[Malicious Insider<br/>Legitimate Node]
        U3[Disk Theft<br/>Physical Access]
        U4[Memory Dump<br/>Running Process]
        U5[Privilege Escalation<br/>Local Attacker]
    end
    
    subgraph "Missing Defenses"
        M1[No Authentication<br/>Anyone can join]
        M2[No Access Control<br/>All-or-nothing access]
        M3[No Encryption at Rest<br/>Files stored plaintext]
        M4[No Memory Protection<br/>Plaintext in RAM]
    end
    
    T1 -.->|Blocked by| D1
    T2 -.->|Blocked by| D2
    T3 -.->|Blocked by| D3
    
    U1 -->|Exploits| M1
    U2 -->|Exploits| M2
    U3 -->|Exploits| M3
    U4 -->|Exploits| M4
    U5 -->|Exploits| M3
    
    classDef protected fill:#c8e6c9,stroke:#2e7d32,stroke-width:2px
    classDef defense fill:#81c784,stroke:#388e3c,stroke-width:3px
    classDef vulnerable fill:#ffcdd2,stroke:#c62828,stroke-width:2px
    classDef missing fill:#ff8a80,stroke:#d32f2f,stroke-width:3px
    
    class T1,T2,T3 protected
    class D1,D2,D3 defense
    class U1,U2,U3,U4,U5 vulnerable
    class M1,M2,M3,M4 missing
            </div>
        </div>
    </div>

    <div id="attack-scenarios">
        <h2>5. Attack Scenario Examples</h2>
        
        <h3>Scenario 1: Network Eavesdropper (Protected ‚úÖ)</h3>
        <div class="diagram-container">
            <div class="mermaid">
sequenceDiagram
    participant Alice as Alice's Node
    participant Attacker as Attacker<br/>(Network Sniffer)
    participant Bob as Bob's Node
    
    Alice->>Bob: üîí Encrypted: FileEventMessage
    Attacker->>Attacker: Intercepts packet
    Attacker->>Attacker: Attempts to decrypt
    
    Note over Attacker: ‚ùå CANNOT DECRYPT<br/>Needs Noise session keys<br/>Keys established via X25519<br/>Attacker doesn't have private keys
    
    Bob->>Bob: ‚úÖ Decrypts successfully<br/>Has correct keys
            </div>
        </div>
        <div class="success">
            <strong>‚úÖ Protected:</strong> Noise protocol encryption prevents eavesdropper from reading file metadata or content.
        </div>

        <h3>Scenario 2: Unauthorized Peer (Vulnerable ‚ùå)</h3>
        <div class="diagram-container">
            <div class="mermaid">
sequenceDiagram
    participant Alice as Alice's Node<br/>CompanyDocs
    participant Attacker as Attacker's Node<br/>Malicious
    participant Bootstrap as Bootstrap Node
    participant Bob as Bob's Node<br/>CompanyDocs
    
    Note over Attacker: Attacker learns bootstrap<br/>node address from DNS/config leak
    
    Attacker->>Bootstrap: Connect to bootstrap
    Bootstrap->>Attacker: ‚úÖ Connection accepted<br/>No authentication!
    
    Attacker->>Attacker: Configure observer:<br/>name = "CompanyDocs"
    
    Alice->>Bootstrap: üîí Encrypted FileEventMessage
    Bootstrap->>Attacker: üîí Encrypted FileEventMessage
    Attacker->>Attacker: ‚úÖ Decrypts<br/>(legitimate Noise session)
    
    Note over Attacker: Sees: "budget.xlsx" updated
    
    Attacker->>Alice: üîí FileTransferRequest<br/>for "budget.xlsx"
    Alice->>Attacker: üîí FileTransferResponse<br/>‚úÖ Sends file!
    
    Note over Attacker: ‚ùå SECURITY BREACH<br/>Attacker now has budget.xlsx
            </div>
        </div>
        <div class="warning">
            <strong>‚ùå Vulnerable:</strong> No authentication means anyone who knows a bootstrap node can join and request files.
        </div>

        <h3>Scenario 3: Disk Theft (Vulnerable ‚ùå)</h3>
        <div class="diagram-container">
            <div class="mermaid">
graph LR
    A[Alice's Laptop] -->|Stolen| B[Attacker]
    
    subgraph "Alice's Disk"
        D1[/home/alice/CompanyDocs/<br/>budget.xlsx - PLAINTEXT]
        D2[/home/alice/CompanyDocs/<br/>payroll.xlsx - PLAINTEXT]
        D3[~/.config/syndactyl/<br/>syndactyl_keypair.key]
    end
    
    B -->|Reads| D1
    B -->|Reads| D2
    B -->|Reads| D3
    
    Note[‚ùå SECURITY BREACH<br/>All files readable<br/>Can impersonate Alice]
    
    D1 -.-> Note
    D2 -.-> Note
    D3 -.-> Note
    
    classDef vulnerable fill:#ffcdd2,stroke:#c62828,stroke-width:2px
    classDef attacker fill:#ff8a80,stroke:#d32f2f,stroke-width:3px
    
    class D1,D2,D3 vulnerable
    class B,Note attacker
            </div>
        </div>
        <div class="warning">
            <strong>‚ùå Vulnerable:</strong> Files stored as plaintext on disk. Consider full-disk encryption (LUKS, FileVault, BitLocker) at OS level.
        </div>
    </div>

    <div id="recommendations">
        <h2>6. Security Recommendations</h2>
        
        <h3>Current State Summary</h3>
        <table>
            <thead>
                <tr>
                    <th>Security Aspect</th>
                    <th>Status</th>
                    <th>Implementation</th>
                    <th>Protection Level</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Transport Encryption</td>
                    <td class="encrypted">‚úÖ IMPLEMENTED</td>
                    <td>Noise Protocol (ChaCha20-Poly1305)</td>
                    <td>Strong</td>
                </tr>
                <tr>
                    <td>Key Exchange</td>
                    <td class="encrypted">‚úÖ IMPLEMENTED</td>
                    <td>X25519 Curve25519</td>
                    <td>Strong</td>
                </tr>
                <tr>
                    <td>Message Authentication</td>
                    <td class="encrypted">‚úÖ IMPLEMENTED</td>
                    <td>Poly1305 MAC</td>
                    <td>Strong</td>
                </tr>
                <tr>
                    <td>Forward Secrecy</td>
                    <td class="encrypted">‚úÖ IMPLEMENTED</td>
                    <td>Noise Protocol XX Pattern</td>
                    <td>Strong</td>
                </tr>
                <tr>
                    <td>Peer Authentication</td>
                    <td class="unencrypted">‚ùå MISSING</td>
                    <td>None</td>
                    <td>None</td>
                </tr>
                <tr>
                    <td>Access Control</td>
                    <td class="unencrypted">‚ùå MISSING</td>
                    <td>None</td>
                    <td>None</td>
                </tr>
                <tr>
                    <td>Encryption at Rest</td>
                    <td class="unencrypted">‚ùå MISSING</td>
                    <td>None (OS-level recommended)</td>
                    <td>None</td>
                </tr>
                <tr>
                    <td>Authorization</td>
                    <td class="unencrypted">‚ùå MISSING</td>
                    <td>None</td>
                    <td>None</td>
                </tr>
            </tbody>
        </table>

        <h3>Recommended Additions</h3>
        
        <div class="code-example">
<strong>1. Add Peer Authentication (Shared Secret per Observer)</strong>

// In config.json - add shared secret
{
  "observers": [
    {
      "name": "CompanyDocs",
      "path": "/home/user/CompanyDocs",
      "shared_secret": "randomly-generated-secret-key-here"
    }
  ]
}

// In FileEventMessage - add HMAC
pub struct FileEventMessage {
    pub observer: String,
    pub event_type: String,
    pub path: String,
    pub hash: Option&lt;String&gt;,
    pub hmac: String,  // HMAC-SHA256(shared_secret, observer + path + hash)
}

// Verify on receive
fn verify_file_event(event: &FileEventMessage, secret: &str) -> bool {
    let data = format!("{}{}{}", event.observer, event.path, 
                      event.hash.as_ref().unwrap_or(&"".to_string()));
    let expected_hmac = hmac_sha256(secret, &data);
    constant_time_compare(&event.hmac, &expected_hmac)
}
        </div>

        <div class="code-example">
<strong>2. Add Public Key Authentication (Better Long-term)</strong>

// Each node has keypair (already exists!)
// Extend to sign messages
pub struct SignedFileEventMessage {
    pub message: FileEventMessage,
    pub signature: Vec&lt;u8&gt;,  // Ed25519 signature
    pub peer_id: String,       // Public key hash
}

// Verify signature
fn verify_signed_message(msg: &SignedFileEventMessage) -> bool {
    let peer_key = peer_id_to_public_key(&msg.peer_id);
    peer_key.verify(&msg.message, &msg.signature).is_ok()
}

// Add ACL (Access Control List)
pub struct ObserverACL {
    pub observer: String,
    pub allowed_peers: Vec&lt;String&gt;,  // PeerIds with access
}
        </div>

        <div class="code-example">
<strong>3. Add Encryption at Rest (Optional - Usually OS Level)</strong>

// Option A: Use OS-level encryption
// - Linux: LUKS (dm-crypt)
// - macOS: FileVault
// - Windows: BitLocker

// Option B: Application-level per-file encryption
use age::Encryptor;  // age encryption library

fn write_encrypted_file(path: &Path, content: &[u8], key: &[u8]) -> Result&lt;()&gt; {
    let encrypted = encrypt_with_key(content, key)?;
    fs::write(path, encrypted)?;
    Ok(())
}

// Store key in system keyring
// - Linux: Secret Service API / gnome-keyring
// - macOS: Keychain
// - Windows: Credential Manager
        </div>
    </div>

    <div id="noise-protocol">
        <h2>7. Noise Protocol Technical Details</h2>
        <div class="description">
            <strong>What Syndactyl Uses:</strong> The Noise Protocol Framework with XX handshake pattern
        </div>
        
        <div class="diagram-container">
            <div class="mermaid">
sequenceDiagram
    participant A as Alice (Initiator)
    participant B as Bob (Responder)
    
    Note over A,B: Noise XX Handshake Pattern
    
    rect rgb(230, 240, 255)
    Note over A: Generate ephemeral keypair
    A->>B: ‚Üí e (ephemeral public key)
    end
    
    rect rgb(240, 255, 230)
    Note over B: Generate ephemeral keypair
    B->>A: ‚Üê e, ee, s (ephemeral, DH, static public)
    Note over A: Now knows Bob's identity
    end
    
    rect rgb(255, 240, 230)
    A->>B: ‚Üí s, se (static public, DH)
    Note over B: Now knows Alice's identity
    end
    
    Note over A,B: Handshake Complete<br/>Symmetric keys established
    
    rect rgb(220, 255, 220)
    Note over A,B: üîí All subsequent messages encrypted
    A->>B: üîí Encrypted: FileEventMessage
    B->>A: üîí Encrypted: FileTransferRequest
    A->>B: üîí Encrypted: FileTransferResponse
    end
            </div>
        </div>

        <div class="code-example">
<strong>Noise Protocol Properties:</strong>

‚úÖ <strong>Confidentiality:</strong> ChaCha20 stream cipher
‚úÖ <strong>Integrity:</strong> Poly1305 MAC (AEAD construction)
‚úÖ <strong>Authentication:</strong> Public keys verified during handshake
‚úÖ <strong>Forward Secrecy:</strong> Ephemeral keys rotated per session
‚úÖ <strong>Replay Protection:</strong> Message counters/nonces
‚úÖ <strong>Modern Crypto:</strong> No RSA, no AES - uses X25519 and ChaCha20

<strong>What it DOESN'T provide:</strong>
‚ùå <strong>Authorization:</strong> Doesn't control WHO can do WHAT
‚ùå <strong>Access Control:</strong> All authenticated peers have equal access
‚ùå <strong>Encryption at Rest:</strong> Only protects data in transit
        </div>
    </div>

    <div style="margin-top: 40px; padding: 20px; background: white; border-radius: 8px;">
        <h2>üìä Encryption Status Summary</h2>
        
        <div class="mermaid">
pie title Encryption Coverage
    "Protected (Transport)" : 1
    "Unprotected (Auth)" : 1
    "Unprotected (At Rest)" : 1
    "Unprotected (Access Control)" : 1
        </div>

        <h3>Bottom Line</h3>
        <div class="success">
            <strong>‚úÖ Good News:</strong> Your data is encrypted while traveling across the network. Network attackers (ISPs, WiFi sniffers, etc.) cannot read your files.
        </div>
        
        <div class="warning">
            <strong>‚ö†Ô∏è Security Gaps:</strong>
            <ol>
                <li><strong>No authentication</strong> - Anyone can join and request files</li>
                <li><strong>No access control</strong> - Can't restrict who accesses what</li>
                <li><strong>No encryption at rest</strong> - Files stored as plaintext on disk</li>
                <li><strong>No audit trail</strong> - Can't track who accessed what</li>
            </ol>
        </div>

        <div class="description">
            <strong>Next Steps:</strong> 
            <ol>
                <li>Implement HMAC-based authentication (shared secrets per observer)</li>
                <li>Add peer allowlists to restrict network access</li>
                <li>Consider OS-level disk encryption (LUKS/FileVault/BitLocker)</li>
                <li>Add logging/audit trail for security events</li>
            </ol>
        </div>

        <p><strong>Related Documentation:</strong></p>
        <ul>
            <li><a href="architecture-diagram.html">Software Architecture Diagrams</a></li>
            <li><a href="network-topology.html">Network Topology Examples</a></li>
            <li><a href="project-analysis-and-recommendations.md">Full Security Analysis</a></li>
        </ul>
    </div>
</body>
</html>
