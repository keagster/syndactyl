<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Syndactyl Network Topology Examples</title>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            securityLevel: 'loose',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });
    </script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #4CAF50;
            padding-bottom: 10px;
        }
        h2 {
            color: #555;
            margin-top: 40px;
            border-bottom: 2px solid #2196F3;
            padding-bottom: 8px;
        }
        .diagram-container {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .description {
            background: #e3f2fd;
            padding: 15px;
            border-left: 4px solid #2196F3;
            margin: 15px 0;
            border-radius: 4px;
        }
        .mermaid {
            text-align: center;
        }
        .nav {
            background: white;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .nav a {
            color: #2196F3;
            text-decoration: none;
            margin-right: 20px;
            font-weight: 500;
        }
        .nav a:hover {
            text-decoration: underline;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #2196F3;
            color: white;
        }
        tr:hover {
            background-color: #f5f5f5;
        }
        .code-block {
            background: #263238;
            color: #aed581;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 20px 0;
        }
        pre {
            margin: 0;
        }
    </style>
</head>
<body>
    <h1>üåê Syndactyl Network Topology Examples</h1>
    
    <div class="nav">
        <strong>Navigation:</strong>
        <a href="architecture-diagram.html">‚Üê Software Architecture</a>
        <a href="#network-overview">Network Overview</a>
        <a href="#gossipsub-topology">Gossipsub Topology</a>
        <a href="#mesh-network">Mesh Network</a>
        <a href="#sync-flow">Sync Flow</a>
        <a href="#physical-layout">Physical Layout</a>
    </div>

    <div class="description">
        <strong>Scenario:</strong> This example demonstrates a realistic deployment with <strong>20 systems</strong> sharing <strong>2 different directories</strong> ("ProjectAlpha" and "CompanyDocs") across multiple physical locations.
    </div>

    <div id="network-overview">
        <h2>1. Network Overview - 20 Nodes with 2 Directories</h2>
        <div class="description">
            <strong>Overview:</strong> Shows how 20 different systems are organized into groups based on which directories they sync. Some nodes participate in both directories.
        </div>
        <div class="diagram-container">
            <div class="mermaid">
graph TB
    subgraph "Bootstrap Nodes"
        B1[Bootstrap Node 1<br/>Alice's Desktop<br/>IP: 192.168.1.10]
        B2[Bootstrap Node 2<br/>Bob's Server<br/>IP: 192.168.1.20]
    end
    
    subgraph "ProjectAlpha Subscribers (12 nodes)"
        PA1[Charlie<br/>Desktop]
        PA2[Diana<br/>Laptop]
        PA3[Eve<br/>Server]
        PA4[Frank<br/>Workstation]
        PA5[Grace<br/>Laptop]
        PA6[Heidi<br/>Desktop]
        PA7[Ivan<br/>Laptop]
        PA8[Judy<br/>Workstation]
        PA9[Mallory<br/>Desktop]
        PA10[Niaj<br/>Laptop]
        PA11[Oscar<br/>Server]
        PA12[Peggy<br/>Desktop]
    end
    
    subgraph "CompanyDocs Subscribers (12 nodes)"
        CD1[Carol<br/>Laptop]
        CD2[Dave<br/>Desktop]
        CD3[Ellen<br/>Laptop]
        CD4[Fred<br/>Workstation]
        CD5[Gina<br/>Desktop]
        CD6[Henry<br/>Laptop]
        CD7[Iris<br/>Desktop]
        CD8[Jack<br/>Server]
        CD9[Kate<br/>Laptop]
        CD10[Leo<br/>Desktop]
        CD11[Mia<br/>Laptop]
        CD12[Nick<br/>Workstation]
    end
    
    subgraph "Both Directories (includes Bootstrap)"
        BOTH1[Alice - Desktop<br/>Both + Bootstrap]
        BOTH2[Bob - Server<br/>Both + Bootstrap]
        BOTH3[Olivia - Laptop<br/>Both Directories]
    end
    
    B1 <-.->|Kademlia DHT| B2
    
    PA1 & PA2 & PA3 & PA4 & PA5 & PA6 -.->|Initial Discovery| B1
    PA7 & PA8 & PA9 & PA10 & PA11 & PA12 -.->|Initial Discovery| B2
    
    CD1 & CD2 & CD3 & CD4 & CD5 & CD6 -.->|Initial Discovery| B1
    CD7 & CD8 & CD9 & CD10 & CD11 & CD12 -.->|Initial Discovery| B2
    
    BOTH1 & BOTH2 & BOTH3 -.->|Participate in Both| B1
    
    classDef bootstrap fill:#ff6b6b,stroke:#c92a2a,stroke-width:3px,color:#fff
    classDef projectAlpha fill:#4ecdc4,stroke:#0a7e7a,stroke-width:2px
    classDef companyDocs fill:#ffe66d,stroke:#c9a700,stroke-width:2px
    classDef both fill:#a8e6cf,stroke:#3d8361,stroke-width:3px
    
    class B1,B2 bootstrap
    class PA1,PA2,PA3,PA4,PA5,PA6,PA7,PA8,PA9,PA10,PA11,PA12 projectAlpha
    class CD1,CD2,CD3,CD4,CD5,CD6,CD7,CD8,CD9,CD10,CD11,CD12 companyDocs
    class BOTH1,BOTH2,BOTH3 both
            </div>
        </div>
    </div>

    <div id="gossipsub-topology">
        <h2>2. Gossipsub Topic Topology</h2>
        <div class="description">
            <strong>Overview:</strong> Shows how all nodes subscribe to the same global topic, but filter messages based on which directories they're configured to sync.
        </div>
        <div class="diagram-container">
            <div class="mermaid">
graph LR
    subgraph "Gossipsub Topics"
        T1[Topic: syndactyl-gossip<br/>Global Events Channel]
    end
    
    subgraph "All Nodes Subscribe"
        AllNodes[All 20 Nodes<br/>Subscribe to<br/>syndactyl-gossip]
    end
    
    subgraph "Message Filtering Logic"
        Filter[Nodes filter messages<br/>based on observer field<br/>in FileEventMessage]
    end
    
    subgraph "Processing Decision"
        Process[Process File Event<br/>If observer matches config]
        Ignore[Ignore Event<br/>If observer not configured]
    end
    
    AllNodes -->|Subscribe| T1
    T1 -->|Broadcast all events| AllNodes
    AllNodes --> Filter
    
    Filter -->|Match Found| Process
    Filter -->|No Match| Ignore
    
    classDef topic fill:#667eea,stroke:#4c51bf,stroke-width:2px,color:#fff
    classDef node fill:#48bb78,stroke:#2f855a,stroke-width:2px
    classDef logic fill:#ed8936,stroke:#c05621,stroke-width:2px
    classDef decision fill:#9f7aea,stroke:#6b46c1,stroke-width:2px
    
    class T1 topic
    class AllNodes node
    class Filter logic
    class Process,Ignore decision
            </div>
        </div>
    </div>

    <div id="mesh-network">
        <h2>3. P2P Mesh Network Topology</h2>
        <div class="description">
            <strong>Overview:</strong> After initial bootstrap discovery, nodes form direct connections with each other in a mesh topology. Gossipsub automatically manages these connections.
        </div>
        <div class="diagram-container">
            <div class="mermaid">
graph TB
    subgraph "Mesh Network - ProjectAlpha Directory"
        N1[Node 1]
        N2[Node 2]
        N3[Node 3]
        N4[Node 4]
        N5[Node 5]
        N6[Node 6]
        N7[Node 7]
        N8[Node 8]
        N9[Node 9]
        N10[Node 10]
        N11[Node 11]
        N12[Node 12]
    end
    
    N1 <-->|Gossipsub| N2
    N1 <-->|Gossipsub| N3
    N1 <-->|Gossipsub| N4
    N2 <-->|Gossipsub| N3
    N2 <-->|Gossipsub| N5
    N3 <-->|Gossipsub| N6
    N4 <-->|Gossipsub| N7
    N5 <-->|Gossipsub| N8
    N6 <-->|Gossipsub| N9
    N7 <-->|Gossipsub| N10
    N8 <-->|Gossipsub| N11
    N9 <-->|Gossipsub| N12
    N10 <-->|Gossipsub| N11
    N11 <-->|Gossipsub| N12
    N4 <-->|Gossipsub| N8
    N5 <-->|Gossipsub| N9
    N6 <-->|Gossipsub| N10
    
    N1 -.->|File Transfer| N7
    N3 -.->|File Transfer| N11
    N5 -.->|File Transfer| N2
    
    classDef meshNode fill:#3b82f6,stroke:#1e40af,stroke-width:2px,color:#fff
    
    class N1,N2,N3,N4,N5,N6,N7,N8,N9,N10,N11,N12 meshNode
            </div>
        </div>
        <div class="description">
            <strong>Note:</strong> Solid lines = Gossipsub mesh connections (pub/sub), Dashed lines = Direct file transfer connections (request-response)
        </div>
    </div>

    <div id="sync-flow">
        <h2>4. File Synchronization Flow Example</h2>
        <div class="description">
            <strong>Overview:</strong> Step-by-step sequence showing what happens when Alice modifies a file and it syncs to other nodes.
        </div>
        <div class="diagram-container">
            <div class="mermaid">
sequenceDiagram
    participant N1 as Node 1<br/>(Alice)
    participant GS as Gossipsub Network
    participant N2 as Node 2<br/>(Bob)
    participant N3 as Node 3<br/>(Charlie)
    participant N4 as Node 4<br/>(Diana)
    
    Note over N1,N4: All nodes watching "ProjectAlpha" directory
    
    rect rgb(200, 230, 255)
    Note right of N1: Alice modifies report.pdf
    N1->>N1: Detect file change
    N1->>N1: Calculate hash: abc123...
    end
    
    rect rgb(255, 230, 200)
    Note over GS: Broadcast Phase
    N1->>GS: Publish FileEventMessage<br/>{observer: "ProjectAlpha",<br/>path: "report.pdf",<br/>hash: "abc123...",<br/>size: 2048576}
    GS->>N2: FileEventMessage
    GS->>N3: FileEventMessage
    GS->>N4: FileEventMessage
    end
    
    rect rgb(200, 255, 200)
    Note over N2,N4: Decision Phase
    N2->>N2: Check local file<br/>hash: xyz789...<br/>DIFFERENT - Need update
    N3->>N3: Check local file<br/>hash: abc123...<br/>SAME - Skip
    N4->>N4: File doesn't exist<br/>Need download
    end
    
    rect rgb(255, 200, 255)
    Note over N2,N4: Transfer Phase
    N2->>N1: FileTransferRequest
    N1->>N2: FileTransferResponse<br/>Chunk 1 (1MB)
    N2->>N1: FileChunkRequest (offset: 1MB)
    N1->>N2: FileTransferResponse<br/>Chunk 2 (0.95MB, last)
    N2->>N2: Verify hash & write to disk
    
    par Node 4 downloads in parallel
        N4->>N1: FileTransferRequest
        N1->>N4: FileTransferResponse<br/>Chunk 1 (1MB)
        N4->>N1: FileChunkRequest (offset: 1MB)
        N1->>N4: FileTransferResponse<br/>Chunk 2 (0.95MB, last)
        N4->>N4: Verify hash & write to disk
    end
    end
    
    Note over N1,N4: Synchronization Complete
            </div>
        </div>
    </div>

    <div id="physical-layout">
        <h2>5. Physical Network Layout Example</h2>
        <div class="description">
            <strong>Overview:</strong> Shows a realistic multi-site deployment with office networks, remote workers, and cloud infrastructure.
        </div>
        <div class="diagram-container">
            <div class="mermaid">
graph TB
    subgraph "Office Network - 192.168.1.0/24"
        Router1[Office Router<br/>192.168.1.1]
        Desktop1[Desktop 1<br/>192.168.1.10<br/>Bootstrap Node]
        Desktop2[Desktop 2<br/>192.168.1.11]
        Desktop3[Desktop 3<br/>192.168.1.12]
        Server1[File Server<br/>192.168.1.20<br/>Bootstrap Node]
        Laptop1[Laptop 1<br/>192.168.1.30]
        Laptop2[Laptop 2<br/>192.168.1.31]
    end
    
    subgraph "Remote Office - 10.0.0.0/24"
        Router2[Remote Router<br/>10.0.0.1]
        Desktop4[Desktop 4<br/>10.0.0.10]
        Desktop5[Desktop 5<br/>10.0.0.11]
        Laptop3[Laptop 3<br/>10.0.0.20]
    end
    
    subgraph "Home Workers"
        Home1[Home Desktop<br/>Dynamic IP<br/>NAT Traversal]
        Home2[Home Laptop<br/>Dynamic IP<br/>NAT Traversal]
    end
    
    subgraph "Cloud VPS"
        VPS1[Cloud Server<br/>Public IP<br/>Bootstrap Node]
    end
    
    Internet((Internet))
    
    Router1 <--> Internet
    Router2 <--> Internet
    Home1 <--> Internet
    Home2 <--> Internet
    VPS1 <--> Internet
    
    Desktop1 & Desktop2 & Desktop3 & Server1 & Laptop1 & Laptop2 --> Router1
    Desktop4 & Desktop5 & Laptop3 --> Router2
    
    classDef router fill:#ff6b6b,stroke:#c92a2a,stroke-width:2px,color:#fff
    classDef bootstrap fill:#51cf66,stroke:#2f9e44,stroke-width:3px
    classDef office fill:#74c0fc,stroke:#1971c2,stroke-width:2px
    classDef remote fill:#ffd43b,stroke:#f59f00,stroke-width:2px
    classDef home fill:#da77f2,stroke:#9c36b5,stroke-width:2px
    classDef cloud fill:#ff8787,stroke:#e03131,stroke-width:2px
    classDef internet fill:#495057,stroke:#212529,stroke-width:3px,color:#fff
    
    class Router1,Router2 router
    class Desktop1,Server1,VPS1 bootstrap
    class Desktop2,Desktop3,Laptop1,Laptop2 office
    class Desktop4,Desktop5,Laptop3 remote
    class Home1,Home2 home
    class VPS1 cloud
    class Internet internet
            </div>
        </div>
    </div>

    <div id="statistics">
        <h2>6. Network Statistics</h2>
        <div class="diagram-container">
            <div class="mermaid">
pie title Directory Subscriptions Distribution
    "ProjectAlpha Only" : 12
    "CompanyDocs Only" : 12
    "Both Directories" : 3
            </div>
        </div>
        <div class="diagram-container">
            <div class="mermaid">
pie title Node Type Distribution
    "Regular Nodes" : 17
    "Bootstrap Nodes" : 3
            </div>
        </div>
    </div>

    <div id="scalability">
        <h2>7. Scalability Considerations</h2>
        <div class="description">
            <strong>Overview:</strong> Shows how the network can grow and the factors that affect performance at different scales.
        </div>
        <div class="diagram-container">
            <div class="mermaid">
graph LR
    subgraph "Network Growth Stages"
        S1[20 Nodes<br/>Small Team]
        S2[50 Nodes<br/>Department]
        S3[100 Nodes<br/>Company]
        S4[500+ Nodes<br/>Enterprise]
    end
    
    subgraph "Performance Factors"
        F1[Gossipsub Mesh Degree<br/>6-12 connections per node]
        F2[File Transfer<br/>1MB chunks<br/>Direct P2P]
        F3[Kademlia DHT<br/>Log N discovery time]
    end
    
    subgraph "Recommended Limits"
        L1[Observers per Node<br/>< 10 directories]
        L2[File Size<br/>< 10GB per file]
        L3[Directory Size<br/>< 100K files]
    end
    
    S1 -->|Add Users| S2
    S2 -->|Add Departments| S3
    S3 -->|Enterprise Scale| S4
    
    S1 -.-> F1
    S2 -.-> F2
    S3 -.-> F3
    S4 -.-> L1
    S4 -.-> L2
    S4 -.-> L3
    
    classDef scale fill:#4ecdc4,stroke:#0a7e7a,stroke-width:2px
    classDef perf fill:#ffe66d,stroke:#c9a700,stroke-width:2px
    classDef limit fill:#ff6b6b,stroke:#c92a2a,stroke-width:2px
    
    class S1,S2,S3,S4 scale
    class F1,F2,F3 perf
    class L1,L2,L3 limit
            </div>
        </div>
    </div>

    <div style="margin-top: 40px; padding: 20px; background: white; border-radius: 8px;">
        <h2>üìä Directory Access Matrix</h2>
        <p>This table shows which nodes have access to which directories in our example network:</p>
        <table>
            <thead>
                <tr>
                    <th>Node Name</th>
                    <th>ProjectAlpha</th>
                    <th>CompanyDocs</th>
                    <th>Role</th>
                </tr>
            </thead>
            <tbody>
                <tr><td>Alice</td><td>‚úì</td><td>‚úì</td><td>Bootstrap</td></tr>
                <tr><td>Bob</td><td>‚úì</td><td>‚úì</td><td>Bootstrap</td></tr>
                <tr><td>Olivia</td><td>‚úì</td><td>‚úì</td><td>Regular</td></tr>
                <tr><td>Charlie</td><td>‚úì</td><td>‚úó</td><td>Regular</td></tr>
                <tr><td>Diana</td><td>‚úì</td><td>‚úó</td><td>Regular</td></tr>
                <tr><td>Eve</td><td>‚úì</td><td>‚úó</td><td>Regular</td></tr>
                <tr><td>Frank</td><td>‚úì</td><td>‚úó</td><td>Regular</td></tr>
                <tr><td>Grace</td><td>‚úì</td><td>‚úó</td><td>Regular</td></tr>
                <tr><td>Heidi</td><td>‚úì</td><td>‚úó</td><td>Regular</td></tr>
                <tr><td>Ivan</td><td>‚úì</td><td>‚úó</td><td>Regular</td></tr>
                <tr><td>Judy</td><td>‚úì</td><td>‚úó</td><td>Regular</td></tr>
                <tr><td>Mallory</td><td>‚úì</td><td>‚úó</td><td>Regular</td></tr>
                <tr><td>Niaj</td><td>‚úì</td><td>‚úó</td><td>Regular</td></tr>
                <tr><td>Oscar</td><td>‚úì</td><td>‚úó</td><td>Regular</td></tr>
                <tr><td>Peggy</td><td>‚úì</td><td>‚úó</td><td>Regular</td></tr>
                <tr><td>Carol</td><td>‚úó</td><td>‚úì</td><td>Regular</td></tr>
                <tr><td>Dave</td><td>‚úó</td><td>‚úì</td><td>Regular</td></tr>
                <tr><td>Ellen</td><td>‚úó</td><td>‚úì</td><td>Regular</td></tr>
                <tr><td>Fred</td><td>‚úó</td><td>‚úì</td><td>Regular</td></tr>
                <tr><td>Gina</td><td>‚úó</td><td>‚úì</td><td>Regular</td></tr>
                <tr><td>Henry</td><td>‚úó</td><td>‚úì</td><td>Regular</td></tr>
            </tbody>
        </table>
        <p><strong>Total: 20 unique nodes</strong></p>
        <ul>
            <li>ProjectAlpha subscribers: 15 nodes (12 exclusive + 3 both)</li>
            <li>CompanyDocs subscribers: 15 nodes (12 exclusive + 3 both)</li>
            <li>Bootstrap nodes: 3 (should have good uptime and public/stable IPs)</li>
        </ul>
    </div>

    <div class="code-block">
        <h3 style="color: #81c784; margin-top: 0;">Example Configuration for Multi-Directory Node</h3>
        <pre>{
  "observers": [
    {
      "name": "ProjectAlpha",
      "path": "/home/user/sync/ProjectAlpha"
    },
    {
      "name": "CompanyDocs",
      "path": "/home/user/sync/CompanyDocs"
    }
  ],
  "network": {
    "listen_addr": "0.0.0.0",
    "port": "49999",
    "dht_mode": "server",
    "bootstrap_peers": [
      {
        "ip": "192.168.1.10",
        "port": "49999",
        "peer_id": "12D3KooWAbc123...BootstrapNode1"
      },
      {
        "ip": "192.168.1.20",
        "port": "49999",
        "peer_id": "12D3KooWDef456...BootstrapNode2"
      },
      {
        "ip": "203.0.113.50",
        "port": "49999",
        "peer_id": "12D3KooWGhi789...CloudBootstrap"
      }
    ]
  }
}</pre>
    </div>

    <div style="margin-top: 40px; padding: 20px; background: white; border-radius: 8px;">
        <h2>üîë Key Takeaways</h2>
        <ul>
            <li><strong>Decentralized:</strong> No central server required; any node can go offline without affecting others</li>
            <li><strong>Mesh Topology:</strong> Nodes connect directly to each other after bootstrap discovery</li>
            <li><strong>Selective Sync:</strong> Nodes only sync directories they're configured for (observer filtering)</li>
            <li><strong>Efficient Broadcasting:</strong> Gossipsub prevents message duplication and manages mesh connections automatically</li>
            <li><strong>Direct Transfers:</strong> Large files are transferred directly peer-to-peer, not broadcasted</li>
            <li><strong>Bootstrap Nodes:</strong> Help with initial discovery but aren't required after connections are established</li>
            <li><strong>NAT Traversal:</strong> Kademlia DHT helps nodes behind NAT connect to each other</li>
            <li><strong>Scalable:</strong> Can grow from small teams to enterprise deployments</li>
        </ul>
        <p><strong>Previous:</strong> <a href="architecture-diagram.html">‚Üê View Software Architecture</a></p>
    </div>
</body>
</html>
